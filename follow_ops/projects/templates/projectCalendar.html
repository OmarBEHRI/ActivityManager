{% extends "projectDetailsBase.html" %}

{% block extra_styles %}
<style>
.calendar-grid {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    gap: 0.5rem;
    padding: 0.5rem;
    background-color: var(--bg-white);
    border: 1px solid var(--border-color);
    border-radius: 0.5rem;
    box-shadow: 0 1px 3px var(--shadow-light);
}
.calendar-day-header {
    font-weight: 600;
    color: var(--text-color-medium);
    text-align: center;
    padding: 0.5rem 0;
}
.calendar-cell {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    min-height: 80px;
    border-radius: 0.375rem;
    background-color: var(--bg-light);
    border: 1px solid var(--border-color);
    padding: 0.5rem;
    position: relative;
}
.calendar-cell.inactive {
    background-color: var(--bg-light);
    color: var(--text-color-light);
    cursor: not-allowed;
}
.calendar-cell.today {
    background-color: var(--primary-color);
    color: var(--bg-white);
    font-weight: 700;
}
.calendar-date {
    font-size: 0.875rem;
    font-weight: 500;
    color: var(--dark-text);
}
.event-badge {
    position: absolute;
    bottom: 0.25rem;
    left: 0.25rem;
    padding: 0.25rem 0.75rem;
    border-radius: 0.375rem;
    font-size: 0.75rem;
    font-weight: 600;
    color: var(--bg-white);
    text-align: center;
    white-space: nowrap;
}
.event-badge.inprogress {
    background-color: var(--primary-color);
}
.event-badge.completed {
    background-color: #4CAF50;
}
.event-badge.planned {
    background-color: #2196F3;
}
</style>
{% endblock %}

{% block content %}
<div class="section-card">
  <div class="flex justify-between items-center mb-4">
    <button id="prevMonthCalendrier" class="px-3 py-1 rounded-md bg-[var(--button-bg-light)] text-[var(--nav-link-color)] hover:bg-gray-200">◀</button>
    <h3 id="currentMonthYearCalendrier" class="text-xl font-semibold text-[var(--dark-text)]">Mois Année</h3>
    <button id="nextMonthCalendrier" class="px-3 py-1 rounded-md bg-[var(--button-bg-light)] text-[var(--nav-link-color)] hover:bg-gray-200">▶</button>
  </div>
  <div class="calendar-grid" id="calendarGridCalendrier">
    <div class="calendar-day-header">Lun</div>
    <div class="calendar-day-header">Mar</div>
    <div class="calendar-day-header">Mer</div>
    <div class="calendar-day-header">Jeu</div>
    <div class="calendar-day-header">Ven</div>
    <div class="calendar-day-header">Sam</div>
    <div class="calendar-day-header">Dim</div>
    <!-- Calendar cells will be generated by JS -->
  </div>
</div>



<script>
document.addEventListener('DOMContentLoaded', () => {
  // Calendrier Tab Calendar
  const calendarGridCalendrier = document.getElementById('calendarGridCalendrier');
  const currentMonthYearCalendrier = document.getElementById('currentMonthYearCalendrier');
  const prevMonthBtnCalendrier = document.getElementById('prevMonthCalendrier');
  const nextMonthBtnCalendrier = document.getElementById('nextMonthCalendrier');
  let currentDateCalendrier = new Date();

  // Example: Replace with your real project activities
  const projectEvents = [
    { date: new Date(2025, 6, 1).toDateString(), name: 'Kickoff Meeting', status: 'planned' },
    { date: new Date(2025, 6, 3).toDateString(), name: 'Sprint 1 Start', status: 'inprogress' },
    { date: new Date(2025, 6, 7).toDateString(), name: 'Revue de code', status: 'completed' },
    { date: new Date(2025, 6, 10).toDateString(), name: 'Livraison V1', status: 'completed' },
    { date: new Date(2025, 6, 12).toDateString(), name: 'Démo Client', status: 'planned' },
    { date: new Date(2025, 6, 15).toDateString(), name: 'Correction Bug', status: 'inprogress' },
    { date: new Date(2025, 6, 18).toDateString(), name: 'Sprint 2 Start', status: 'planned' },
    { date: new Date(2025, 6, 22).toDateString(), name: 'Revue de code', status: 'planned' },
    { date: new Date(2025, 6, 25).toDateString(), name: 'Livraison V2', status: 'planned' },
    { date: new Date(2025, 6, 28).toDateString(), name: 'Rétrospective', status: 'planned' }
  ];

  // Function to render calendar - reusable for both calendars
  const renderCalendar = (calendarGrid, currentDate, currentMonthYear) => {
    calendarGrid.innerHTML = `
      <div class="calendar-day-header">Lun</div>
      <div class="calendar-day-header">Mar</div>
      <div class="calendar-day-header">Mer</div>
      <div class="calendar-day-header">Jeu</div>
      <div class="calendar-day-header">Ven</div>
      <div class="calendar-day-header">Sam</div>
      <div class="calendar-day-header">Dim</div>
    `;
    const year = currentDate.getFullYear();
    const month = currentDate.getMonth();
    currentMonthYear.textContent = new Date(year, month).toLocaleString('fr-FR', { month: 'long', year: 'numeric' });
    const firstDayOfMonth = new Date(year, month, 1).getDay();
    const startDayIndex = (firstDayOfMonth === 0) ? 6 : firstDayOfMonth - 1;
    const daysInMonth = new Date(year, month + 1, 0).getDate();
    const daysInPrevMonth = new Date(year, month, 0).getDate();

    // Previous month padding
    for (let i = 0; i < startDayIndex; i++) {
      const day = daysInPrevMonth - startDayIndex + i + 1;
      const cell = document.createElement('div');
      cell.classList.add('calendar-cell', 'inactive');
      cell.innerHTML = `<span class="calendar-date">${day}</span>`;
      calendarGrid.appendChild(cell);
    }

    // Current month days
    for (let day = 1; day <= daysInMonth; day++) {
      const cell = document.createElement('div');
      cell.classList.add('calendar-cell');
      const currentDay = new Date(year, month, day);
      if (currentDay.toDateString() === new Date().toDateString()) {
        cell.classList.add('today');
      }
      cell.innerHTML = `<span class="calendar-date">${day}</span>`;
      const eventsForDay = projectEvents.filter(event => new Date(event.date).toDateString() === currentDay.toDateString());
      eventsForDay.forEach(event => {
        const eventDiv = document.createElement('div');
        eventDiv.classList.add('event-badge', event.status);
        eventDiv.textContent = event.name;
        cell.appendChild(eventDiv);
      });
      calendarGrid.appendChild(cell);
    }

    // Next month padding
    const totalCells = startDayIndex + daysInMonth;
    const remainingCells = 42 - totalCells;
    for (let i = 1; i <= remainingCells; i++) {
      const cell = document.createElement('div');
      cell.classList.add('calendar-cell', 'inactive');
      cell.innerHTML = `<span class="calendar-date">${i}</span>`;
      calendarGrid.appendChild(cell);
    }
  };

  // Initialize Calendrier Tab Calendar
  prevMonthBtnCalendrier.addEventListener('click', () => {
    currentDateCalendrier.setMonth(currentDateCalendrier.getMonth() - 1);
    renderCalendar(calendarGridCalendrier, currentDateCalendrier, currentMonthYearCalendrier);
  });
  nextMonthBtnCalendrier.addEventListener('click', () => {
    currentDateCalendrier.setMonth(currentDateCalendrier.getMonth() + 1);
    renderCalendar(calendarGridCalendrier, currentDateCalendrier, currentMonthYearCalendrier);
  });
  renderCalendar(calendarGridCalendrier, currentDateCalendrier, currentMonthYearCalendrier);
});
</script>
{% endblock %}

{% block active_tab %}showTab('calendrier');{% endblock %}